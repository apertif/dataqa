
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>report.html_report_content_continuum &#8212; DataQA 1.0.0 documentation</title>
    <link rel="stylesheet" href="../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">DataQA 1.0.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for report.html_report_content_continuum</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">astropy.table</span> <span class="k">import</span> <span class="n">Table</span><span class="p">,</span> <span class="n">join</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="write_obs_content_continuum"><a class="viewcode-back" href="../../report_html_report_content_continuum.html#report.html_report_content_continuum.write_obs_content_continuum">[docs]</a><span class="k">def</span> <span class="nf">write_obs_content_continuum</span><span class="p">(</span><span class="n">html_code</span><span class="p">,</span> <span class="n">qa_report_obs_path</span><span class="p">,</span> <span class="n">page_type</span><span class="p">,</span> <span class="n">obs_info</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function to create the html page for continuum</span>

<span class="sd">    Args:</span>
<span class="sd">        html_code (str): HTML code with header and title</span>
<span class="sd">        qa_report_obs_path (str): Path to the report directory</span>
<span class="sd">        page_type (str): The type of report page</span>
<span class="sd">        obs_info (list(str)): Basic information of observation</span>

<span class="sd">    Return:</span>
<span class="sd">        html_code (str): Body of HTML code for this page</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Writing html code for page </span><span class="si">{0:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">page_type</span><span class="p">))</span>

    <span class="n">html_code</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        &lt;div class=&quot;w3-container w3-large&quot;&gt;</span>
<span class="s2">            &lt;p&gt;</span>
<span class="s2">                Here you can inspect for each beam the continuum image, PyBDSF diagnostic plots and the validation tool. The PyBDSF catalog is not accessible from this page, but can be found in the QA directory as a csv table.</span>
<span class="s2">                Of course, all of this only exists for beams with a continuum image created by the pipeline.&lt;br&gt;</span>
<span class="s2">                This page will only have content after the continuum QA step has been performed.</span>
<span class="s2">            &lt;/p&gt;</span>
<span class="s2">        &lt;/div&gt;</span><span class="se">\n</span><span class="s2"></span>
<span class="s2">        &quot;&quot;&quot;</span>

    <span class="n">qa_report_obs_page_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">qa_report_obs_path</span><span class="p">,</span> <span class="n">page_type</span><span class="p">)</span>

    <span class="c1"># Create html code for summary table</span>
    <span class="c1"># ==================================</span>

    <span class="k">if</span> <span class="n">obs_info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">obs_id</span> <span class="o">=</span> <span class="n">obs_info</span><span class="p">[</span><span class="s1">&#39;Obs_ID&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">source_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span><span class="n">obs_info</span><span class="p">[</span><span class="s1">&#39;Target&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">obs_info</span><span class="p">[</span><span class="s1">&#39;Flux_Calibrator&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">obs_info</span><span class="p">[</span><span class="s1">&#39;Pol_Calibrator&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">obs_id</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">qa_report_obs_path</span><span class="p">)</span>
        <span class="n">source_list</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># set the file name where information from the param*npy is stored</span>
    <span class="n">continuum_summary_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">qa_report_obs_page_path</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">_</span><span class="si">{1}</span><span class="s2">_summary.csv&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">obs_id</span><span class="p">,</span> <span class="n">page_type</span><span class="p">))</span>

    <span class="c1"># set the file name where information of the image properties is stored</span>
    <span class="n">continuum_image_properties_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">qa_report_obs_page_path</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">_combined_continuum_image_properties.csv&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">obs_id</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">continuum_summary_file</span><span class="p">):</span>
        <span class="n">summary_table</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">continuum_summary_file</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;ascii.csv&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">summary_table</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">continuum_image_properties_file</span><span class="p">):</span>
        <span class="n">image_properties_table</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span>
            <span class="n">continuum_image_properties_file</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;ascii.csv&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">summary_table</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">summary_table</span> <span class="o">=</span> <span class="n">image_properties_table</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">summary_table</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span>
                <span class="n">summary_table</span><span class="p">,</span> <span class="n">image_properties_table</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="s1">&#39;beam&#39;</span><span class="p">)</span>

    <span class="c1"># if there is a summary table</span>
    <span class="c1"># create tables for each source</span>
    <span class="k">if</span> <span class="n">summary_table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

         <span class="c1"># get the keys for the table</span>
        <span class="n">table_keys</span> <span class="o">=</span> <span class="n">summary_table</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

        <span class="n">html_code</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;div class=&quot;w3-container&quot;&gt;</span>
<span class="s2">                    &lt;button class=&quot;w3-btn w3-large w3-center w3-block w3-border-gray w3-amber w3-hover-yellow w3-margin-bottom&quot; onclick=&quot;show_hide_plots(&#39;gallery-1&#39;)&quot;&gt;</span>
<span class="s2">                        Continuum summary table</span>
<span class="s2">                    &lt;/button&gt;</span>
<span class="s2">                &lt;/div&gt;</span>
<span class="s2">            &lt;div class=&quot;w3-container w3-margin-top w3-hide&quot; name=&quot;gallery-1&quot;&gt;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span>

        <span class="n">beam_list</span> <span class="o">=</span> <span class="n">summary_table</span><span class="p">[</span><span class="s1">&#39;beam&#39;</span><span class="p">]</span>

        <span class="c1"># beginning of table</span>
        <span class="n">html_code</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;div class=&quot;w3-container w3-center&quot;&gt;</span>
<span class="s2">                    &lt;div class=&quot;w3-responsive&quot;&gt;</span>
<span class="s2">                        &lt;table class=&quot;w3-table-all&quot;&gt;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span>

        <span class="c1"># write the header</span>
        <span class="n">html_code</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                            &lt;tr class=&quot;w3-amber&quot;&gt;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span>

        <span class="c1"># fill header keys</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">table_keys</span><span class="p">:</span>
            <span class="c1"># make sure that the beam is always there</span>
            <span class="n">html_code</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;&lt;th&gt;</span><span class="si">{}</span><span class="s2">&lt;/th&gt;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;targetbeams_&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>

        <span class="c1"># close table header</span>
        <span class="n">html_code</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;&lt;/tr&gt;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">beam_list</span><span class="p">)):</span>

            <span class="c1"># open row</span>
            <span class="n">html_code</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;&lt;tr&gt;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span>

            <span class="c1"># now go through keys and fill table</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">table_keys</span><span class="p">:</span>

                <span class="c1"># get the element from table</span>
                <span class="n">element</span> <span class="o">=</span> <span class="n">summary_table</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>

                <span class="c1"># check whether it is masked</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">is_masked</span><span class="p">(</span><span class="n">element</span><span class="p">):</span>
                    <span class="n">html_code</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;&lt;td&gt;-&lt;/td&gt;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">html_code</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;&lt;td&gt;</span><span class="si">{0}</span><span class="s2">&lt;/td&gt;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>

            <span class="c1"># close row</span>
            <span class="n">html_code</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;&lt;/tr&gt;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span>

        <span class="c1"># end of table</span>
        <span class="n">html_code</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    &lt;/table&gt;</span>
<span class="s2">                &lt;/div&gt;</span>
<span class="s2">            &lt;/div&gt;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span>

        <span class="n">html_code</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;&lt;/div&gt;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No continuum table found&quot;</span><span class="p">)</span>
        <span class="n">html_code</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;div class=&quot;w3-container&quot;&gt;</span>
<span class="s2">                &lt;button class=&quot;w3-btn w3-large w3-center w3-block w3-border-gray w3-amber w3-hover-yellow w3-margin-bottom w3-disabled&quot; onclick=&quot;show_hide_plots(&#39;gallery-1&#39;)&quot;&gt;</span>
<span class="s2">                    Continuum summary table</span>
<span class="s2">                &lt;/button&gt;</span>
<span class="s2">            &lt;/div&gt;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span>

    <span class="c1"># get beams</span>
    <span class="n">beam_list</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span>
        <span class="s2">&quot;</span><span class="si">{0:s}</span><span class="s2">/</span><span class="si">{1:s}</span><span class="s2">/[0-3][0-9]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">qa_report_obs_path</span><span class="p">,</span> <span class="n">page_type</span><span class="p">))</span>

    <span class="n">n_beams</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">beam_list</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">n_beams</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>

        <span class="n">beam_list</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

        <span class="n">beam_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">beam_list</span><span class="p">)</span>

        <span class="c1"># get a list of beam numbers</span>
        <span class="n">beam_nr_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">beam</span><span class="p">)</span> <span class="k">for</span> <span class="n">beam</span> <span class="ow">in</span> <span class="n">beam_list</span><span class="p">])</span>

        <span class="c1"># get a list of reference beams</span>
        <span class="n">beam_nr_list_ref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;</span><span class="si">{0:02d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">beam</span><span class="p">)</span> <span class="k">for</span> <span class="n">beam</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">40</span><span class="p">)])</span>

        <span class="c1"># Create html code for continuum images gallery</span>
        <span class="c1"># =============================================</span>

        <span class="c1"># get a list of all images to make sure that at least one exists</span>
        <span class="n">image_list</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{0:s}</span><span class="s2">/</span><span class="si">{1:s}</span><span class="s2">/[0-3][0-9]/image_mf_[0-9][0-9].png&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">qa_report_obs_path</span><span class="p">,</span> <span class="n">page_type</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">image_list</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">html_code</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;div class=&quot;w3-container&quot;&gt;</span>
<span class="s2">                    &lt;button class=&quot;w3-btn w3-large w3-center w3-block w3-border-gray w3-amber w3-hover-yellow w3-margin-bottom&quot; onclick=&quot;show_hide_plots(&#39;</span><span class="si">{0:s}</span><span class="s2">&#39;)&quot;&gt;</span><span class="si">{1:s}</span><span class="s2"></span>
<span class="s2">                    &lt;/button&gt;</span>
<span class="s2">                &lt;/div&gt;</span>
<span class="s2">                &lt;div class=&quot;w3-container w3-margin-top w3-hide&quot; name=&quot;</span><span class="si">{0:s}</span><span class="s2">&quot;&gt;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;gallery_cont&quot;</span><span class="p">,</span> <span class="s2">&quot;Continuum images&quot;</span><span class="p">)</span>

            <span class="n">img_counter</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">for</span> <span class="n">beam_nr</span> <span class="ow">in</span> <span class="n">beam_nr_list_ref</span><span class="p">:</span>

                <span class="c1"># to properly make the gallery</span>
                <span class="k">if</span> <span class="n">img_counter</span> <span class="o">%</span> <span class="mi">4</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">html_code</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;&lt;div class=&quot;w3-row&quot;&gt;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span>

                <span class="k">if</span> <span class="n">beam_nr</span> <span class="ow">in</span> <span class="n">beam_nr_list</span><span class="p">:</span>
                    <span class="n">beam</span> <span class="o">=</span> <span class="n">beam_list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">beam_nr_list</span> <span class="o">==</span> <span class="n">beam_nr</span><span class="p">)[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>

                    <span class="c1"># get the phase plots</span>
                    <span class="n">image_list</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="n">beam</span><span class="p">,</span> <span class="s2">&quot;image_mf_[0-9][0-9].png&quot;</span><span class="p">))</span>

                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">image_list</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">image</span> <span class="o">=</span> <span class="n">image_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">image_exists</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">image_exists</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">image_exists</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="c1"># if no image exists leave it empty</span>
                <span class="k">if</span> <span class="n">image_exists</span><span class="p">:</span>
                    <span class="n">html_code</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    &lt;div class=&quot;w3-quarter w3-border&quot;&gt;</span>
<span class="s2">                        &lt;a href=&quot;</span><span class="si">{0:s}</span><span class="s2">/</span><span class="si">{1:s}</span><span class="s2">/</span><span class="si">{2:s}</span><span class="s2">&quot;&gt;</span>
<span class="s2">                            &lt;img src=&quot;</span><span class="si">{0:s}</span><span class="s2">/</span><span class="si">{1:s}</span><span class="s2">/</span><span class="si">{2:s}</span><span class="s2">&quot; alt=&quot;No image&quot; style=&quot;width:100%&quot;&gt;</span>
<span class="s2">                        &lt;/a&gt;</span>
<span class="s2">                        &lt;div class=&quot;w3-container w3-center&quot;&gt;</span>
<span class="s2">                            &lt;h5&gt;Beam </span><span class="si">{1:s}</span><span class="s2">&lt;/h5&gt;</span>
<span class="s2">                        &lt;/div&gt;</span>
<span class="s2">                    &lt;/div&gt;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">page_type</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">beam</span><span class="p">),</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">image</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">html_code</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                        &lt;div class=&quot;w3-quarter&quot;&gt;</span>
<span class="s2">                            &lt;img src=&quot;&quot; alt=&quot;No image for beam </span><span class="si">{0:s}</span><span class="s2">&quot;, width=&quot;100%&quot;&gt;</span>
<span class="s2">                        &lt;/div&gt;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">beam_nr</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">img_counter</span> <span class="o">%</span> <span class="mi">4</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">or</span> <span class="n">img_counter</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">beam_nr_list_ref</span><span class="p">):</span>
                    <span class="n">html_code</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;&lt;/div&gt;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span>

                <span class="n">img_counter</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">html_code</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;&lt;/div&gt;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">html_code</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;div class=&quot;w3-container&quot;&gt;</span>
<span class="s2">                    &lt;button class=&quot;w3-btn w3-large w3-center w3-block w3-border-gray w3-amber w3-hover-yellow w3-margin-bottom w3-disabled&quot; onclick=&quot;show_hide_plots(&#39;</span><span class="si">{0:s}</span><span class="s2">&#39;)&quot;&gt;</span>
<span class="s2">                </span><span class="si">{1:s}</span><span class="s2"></span>
<span class="s2">                    &lt;/button&gt;</span>
<span class="s2">                &lt;/div&gt;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;gallery_cont&quot;</span><span class="p">,</span> <span class="s2">&quot;Continuum images&quot;</span><span class="p">)</span>

        <span class="c1"># Create html code for beam plots</span>
        <span class="c1"># ===============================</span>

        <span class="k">for</span> <span class="n">beam_nr</span> <span class="ow">in</span> <span class="n">beam_nr_list_ref</span><span class="p">:</span>

            <span class="n">button_html_name</span> <span class="o">=</span> <span class="s2">&quot;beam</span><span class="si">{0:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">beam_nr</span><span class="p">)</span>
            <span class="n">div_name</span> <span class="o">=</span> <span class="s2">&quot;continuum_gallery</span><span class="si">{0:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">beam_nr</span><span class="p">)</span>

            <span class="c1"># get the diagnostic plots</span>
            <span class="k">if</span> <span class="n">beam_nr</span> <span class="ow">in</span> <span class="n">beam_nr_list</span><span class="p">:</span>
                <span class="n">image_list</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="si">{0:s}</span><span class="s2">/*png&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">beam_list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">beam_nr_list</span> <span class="o">==</span> <span class="n">beam_nr</span><span class="p">)[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">image_list</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">n_images</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">image_list</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">n_images</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>

                <span class="n">image_list</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

                <span class="n">html_code</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                        &lt;div class=&quot;w3-container&quot;&gt;</span>
<span class="s2">                            &lt;button class=&quot;w3-btn w3-large w3-center w3-block w3-border-gray w3-amber w3-hover-yellow w3-margin-bottom&quot; onclick=&quot;show_hide_plots(&#39;</span><span class="si">{0:s}</span><span class="s2">&#39;)&quot;&gt;</span>
<span class="s2">                            Beam </span><span class="si">{1:s}</span><span class="s2"></span>
<span class="s2">                            &lt;/button&gt;</span>
<span class="s2">                        &lt;/div&gt;</span>
<span class="s2">                        &lt;div class=&quot;w3-container w3-margin-top w3-hide&quot; name=&quot;</span><span class="si">{0:s}</span><span class="s2">&quot;&gt;</span>
<span class="s2">                            &lt;div class=&quot;w3-container&quot;&gt;</span>
<span class="s2">                                &lt;button class=&quot;w3-btn w3-large w3-center w3-block w3-border-gray w3-dark-gray w3-hover-gray w3-margin-bottom&quot; class=&quot;button_continuum&quot; onclick=&quot;show_hide_plots(&#39;</span><span class="si">{2:s}</span><span class="s2">&#39;)&quot;&gt;</span>
<span class="s2">                                    PyBDSF Diagnostic plots</span>
<span class="s2">                                &lt;/button&gt;</span>
<span class="s2">                            &lt;/div&gt;</span>
<span class="s2">                            &lt;div class=&quot;w3-container w3-margin-top w3-hide&quot; name=&quot;</span><span class="si">{2:s}</span><span class="s2">&quot;&gt;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">button_html_name</span><span class="p">,</span> <span class="n">beam_nr</span><span class="p">,</span> <span class="n">div_name</span><span class="p">)</span>

                <span class="c1"># go throught the different types of plots</span>
                <span class="c1"># they require a different layout because the plot sizes vary</span>
                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_images</span><span class="p">):</span>

                    <span class="k">if</span> <span class="n">m</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">html_code</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;&lt;div class=&quot;w3-row&quot;&gt;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span>

                    <span class="n">html_code</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                        &lt;div class=&quot;w3-third w3-border&quot;&gt;</span>
<span class="s2">                            &lt;a href=&quot;</span><span class="si">{0:s}</span><span class="s2">/</span><span class="si">{1:s}</span><span class="s2">/</span><span class="si">{2:s}</span><span class="s2">&quot;&gt;</span>
<span class="s2">                                &lt;img src=&quot;</span><span class="si">{0:s}</span><span class="s2">/</span><span class="si">{1:s}</span><span class="s2">/</span><span class="si">{2:s}</span><span class="s2">&quot; alt=&quot;No image&quot;, width=&quot;100%&quot;&gt;</span>
<span class="s2">                            &lt;/a&gt;</span>
<span class="s2">                        &lt;/div&gt;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">page_type</span><span class="p">,</span> <span class="n">beam_nr</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">image_list</span><span class="p">[</span><span class="n">m</span><span class="p">]))</span>

                    <span class="k">if</span> <span class="n">m</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">m</span> <span class="o">==</span> <span class="n">n_images</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">html_code</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;&lt;/div&gt;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span>

                <span class="n">html_code</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;&lt;/div&gt;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span>

                <span class="c1"># add the validation tool</span>
                <span class="n">frame_name</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="si">{0:s}</span><span class="s2">/*continuum_validation_pybdsf_snr5.0_int&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">beam_list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">beam_nr_list</span> <span class="o">==</span> <span class="n">beam_nr</span><span class="p">)[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]))</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">frame_name</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">frame_name</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">frame_name</span> <span class="o">=</span> <span class="n">frame_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">frame_name</span><span class="p">):</span>

                        <span class="n">button_name</span> <span class="o">=</span> <span class="s2">&quot;validation_tool</span><span class="si">{0:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">beam_nr</span><span class="p">)</span>

                        <span class="n">html_code</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                            &lt;div class=&quot;w3-container&quot;&gt;</span>
<span class="s2">                                &lt;button class=&quot;w3-btn w3-large w3-center w3-block w3-border-gray w3-dark-gray w3-hover-gray w3-margin-bottom&quot; class=&quot;button_continuum&quot; onclick=&quot;show_hide_plots(&#39;</span><span class="si">{0:s}</span><span class="s2">&#39;)&quot;&gt;</span>
<span class="s2">                                    Validation Tool</span>
<span class="s2">                                &lt;/button&gt;</span>
<span class="s2">                            &lt;/div&gt;</span>
<span class="s2">                            &lt;div class=&quot;w3-container w3-margin-top w3-hide&quot; name=&quot;</span><span class="si">{0:s}</span><span class="s2">&quot;&gt;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">button_name</span><span class="p">)</span>

                        <span class="n">html_code</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                                &lt;div class=&quot;w3-container w3-large&quot;&gt;</span>
<span class="s2">                                    &lt;a href=&quot;</span><span class="si">{0:s}</span><span class="s2">/</span><span class="si">{1:s}</span><span class="s2">/</span><span class="si">{2:s}</span><span class="s2">/index.html&quot;&gt;Click here to open the validation tool&lt;/a&gt; if it is not shown below</span>
<span class="s2">                                &lt;/div&gt;</span>
<span class="s2">                                &lt;div class=&quot;w3-container&quot;&gt;</span>
<span class="s2">                                    &lt;iframe class=&quot;w3-container&quot; style=&quot;width:100%; height:1200px&quot; src=&quot;</span><span class="si">{0:s}</span><span class="s2">/</span><span class="si">{1:s}</span><span class="s2">/</span><span class="si">{2:s}</span><span class="s2">/index.html&quot;&gt;&lt;/iframe&gt;</span>
<span class="s2">                                &lt;/div&gt;</span>
<span class="s2">                            &lt;/div&gt;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">page_type</span><span class="p">,</span> <span class="n">beam_nr</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">frame_name</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No continuum validation tool found for beam </span><span class="si">{0:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">beam_nr</span><span class="p">))</span>
                        <span class="n">html_code</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                            &lt;div class=&quot;w3-container&quot;&gt;</span>
<span class="s2">                                &lt;button class=&quot;w3-btn w3-large w3-center w3-block w3-border-gray w3-dark-gray w3-hover-gray w3-margin-bottom&quot; class=&quot;button_continuum&quot; onclick=&quot;show_hide_plots(&#39;</span><span class="si">{0:s}</span><span class="s2">&#39;)&quot;&gt;</span>
<span class="s2">                                    Validation Tool</span>
<span class="s2">                                &lt;/button&gt;</span>
<span class="s2">                            &lt;/div&gt;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">button_html_name</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No continuum validation tool found for beam </span><span class="si">{0:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">beam_nr</span><span class="p">))</span>
                    <span class="n">html_code</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                        &lt;div class=&quot;w3-container&quot;&gt;</span>
<span class="s2">                            &lt;button class=&quot;w3-btn w3-large w3-center w3-block w3-border-gray w3-dark-gray w3-hover-gray w3-margin-bottom&quot; class=&quot;button_continuum&quot; onclick=&quot;show_hide_plots(&#39;</span><span class="si">{0:s}</span><span class="s2">&#39;)&quot;&gt;</span>
<span class="s2">                                Validation Tool</span>
<span class="s2">                            &lt;/button&gt;</span>
<span class="s2">                        &lt;/div&gt;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">button_html_name</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No continuum plots and validation found for beam </span><span class="si">{0:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">beam_nr</span><span class="p">))</span>
                <span class="n">html_code</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;div class=&quot;w3-container&quot;&gt;</span>
<span class="s2">                    &lt;button class=&quot;w3-btn w3-large w3-center w3-block w3-border-gray w3-amber w3-hover-yellow w3-margin-bottom w3-disabled&quot; class=&quot;disabled&quot; onclick=&quot;show_hide_plots(&#39;</span><span class="si">{0:s}</span><span class="s2">&#39;)&quot;&gt;</span>
<span class="s2">                        Beam </span><span class="si">{1:s}</span><span class="s2"></span>
<span class="s2">                    &lt;/button&gt;</span>
<span class="s2">                &lt;/div&gt;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">button_html_name</span><span class="p">,</span> <span class="n">beam_nr</span><span class="p">)</span>

            <span class="n">html_code</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;&lt;/div&gt;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span>

            <span class="c1"># html_code += &quot;&quot;&quot;</span>
            <span class="c1">#     &lt;div class=&quot;gallery&quot; name=&quot;{0:s}&quot;&gt;</span>
            <span class="c1">#         &lt;p class=&quot;warning&quot;&gt;</span>
            <span class="c1">#             No plots and validation tool were found for {1:s}</span>
            <span class="c1">#         &lt;/p&gt;</span>
            <span class="c1">#     &lt;/div&gt;\n&quot;&quot;&quot;.format(button_html_name, page_type)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No beams for continuum QA found&quot;</span><span class="p">)</span>
        <span class="n">html_code</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        &lt;div class=&quot;w3-container w3-large w3-text-red&quot;&gt;</span>
<span class="s2">            &lt;p&gt;</span>
<span class="s2">                No beams were found for continuum QA.</span>
<span class="s2">            &lt;/p&gt;</span>
<span class="s2">        &lt;/div</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">html_code</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">DataQA 1.0.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, Apertif Imaging Team.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.4.
    </div>
  </body>
</html>